---
description: PIV TDD enforcement for test files
globs: ["*.test.*", "*.spec.*", "__tests__/*", "test/*", "tests/*"]
alwaysApply: false
---

# TDD Requirements (MANDATORY)

**RED ‚Üí GREEN ‚Üí REFACTOR** - No exceptions.

## The Cycle (SEQUENTIAL - NO EXCEPTIONS)

| Phase | Action | Tool | Verify |
|-------|--------|------|--------|
| üî¥ RED | Write failing test | `Write` / `StrReplace` | Run `Shell` ‚Üí see failure |
| üü¢ GREEN | Write minimal implementation | `Write` / `StrReplace` | Run `Shell` ‚Üí see pass |
| üîµ REFACTOR | Improve code | `Write` / `StrReplace` | Run `Shell` ‚Üí still passes |

## Critical Rules

- ‚ùå **NEVER** write test and implementation in the same tool call
- ‚ùå **NEVER** skip running tests between phases
- ‚ùå **NEVER** create multiple files at once
- ‚úÖ **ALWAYS** use `Shell` tool to run tests (e.g., `npm test`)
- ‚úÖ **ALWAYS** use `Read` tool to check `package.json` for test command first
- ‚úÖ **ALWAYS** verify test output before proceeding to next phase

## Checkpoints (ASK user before proceeding)

- After RED: "Test fails as expected. Proceed to GREEN phase?"
- After GREEN: "Test passes. Refactor or move to next test?"

## Test Structure (Given-When-Then)

```javascript
// GIVEN: Setup test data and preconditions
const input = { name: "Test", email: "test@example.com" };

// WHEN: Execute the code being tested
const result = await service.create(input);

// THEN: Verify expected outcomes
expect(result.id).toBeDefined();
```

<!-- PIV Spec-Kit v2.1.0 -->
